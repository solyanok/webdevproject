const Auth = require("../models/userModels");
const argon2 = require("argon2"); 
const jwt = require("jsonwebtoken");
const validator = require("validator");
const register = async (req, res) => {
 const salt = "260idk"
const { email, username, password, password2 } = req.body;
if(!email || !password || !password2) {
    return res.json({ ok: false, message: "All fields required" });
  }
if (password !== password2) {
    return res.json({ ok: false, message: "Passwords must match" });
  }
  if (!validator.isEmail(email)) {
    return res.json({ ok: false, message: "Invalid email" });
  }
  try {
    const userFromEmail = await Auth.findOne({ email });
    const userFromName = await Auth.findOne({ username });
    if (userFromEmail) return res.json({ ok: false, message: "User with this email already exists!" });
    if (userFromName) return res.json({ ok: false, message: "User with this username already exists!" });

    const hash = await argon2.hash(password, salt);

    const newUser = {email, password: hash,};
      await User.create(newUser);
      res.json({ ok: true, message: `${username} successfully registered` });
    } catch (e) {
      console.log(e);
      res.json({ ok: false, message: "Something went wrong" });
    }


}










module.exports = { register, login, verify_token };